# HR Analytics Dashaboard ユーザーガイド

## 目次

1. [はじめに](#はじめに)
2. [インストールと起動方法](#インストールと起動方法)
3. [ダッシュボードの基本操作](#ダッシュボードの基本操作)
4. [画面別機能詳細](#画面別機能詳細)
   - [ホーム画面](#ホーム画面)
   - [離職分析](#離職分析)
   - [人材獲得分析](#人材獲得分析)
   - [人材育成・パフォーマンス分析](#人材育成パフォーマンス分析)
   - [給与・報酬分析](#給与報酬分析)
   - [従業員エンゲージメント](#従業員エンゲージメント)
   - [労働生産性/ワークスタイル分析](#労働生産性ワークスタイル分析)
   - [予測分析・シミュレーション](#予測分析シミュレーション)
5. [分析モデル詳細](#分析モデル詳細)
6. [高度な分析機能](#高度な分析機能)
7. [データの更新方法](#データの更新方法)
8. [よくある質問](#よくある質問)
9. [トラブルシューティング](#トラブルシューティング)


## はじめに

HR Analytics Dashaboard（以下、HRADとする）は、企業の人事データを可視化・分析し、データに基づく戦略的な人事意思決定を支援するためのツールです。ここではダミーデータとして[IBMのHRアナリティクスデータセット](https://www.kaggle.com/datasets/pavansubhasht/ibm-hr-analytics-attrition-dataset)を活用し、従業員の離職予測、給与分析、人員計画など、さまざまな人事課題に対する分析をおこなっています。

本システムの主な特徴
- 直観的なインターフェースによる人事データの可視化
- 機械学習モデルを活用した離職予測と給与予測
- インタラクティブなシミュレーション機能
- 部門別・職種別の詳細分析
- データに基づく意思決定支援


## インストールと起動方法

### 必要条件
- Python 3.8以上
- pip（Pythonパッケージ管理ツール）

### インストール手順

1. リポジトリをクローンまたはダウンロードします。
```bash
git clone https://github.com/yf591/hr-analytics-dashboard.git
cd hr-analytics-dashboard
```

2. 仮想環境を作成して有効化します。よほどのことがない限りは仮想環境を構築することを推奨します。
```bash
# Windowsの場合
python -m venv venv
venv\Scripts\activate

# macOS/Linuxの場合
python3 -m venv venv
source venv/bin/activate
```

3. 必要なパッケージをインストールします。
```bash
pip install -r requirements.txt
```

### 起動方法

1. 仮想環境が有効化されていることを確認します。有効化されていない場合は、以下のコマンドで有効化します。
```bash
# Windowsの場合
venv\Scripts\activate

# macOS/Linuxの場合
source venv/bin/activate
```

2. コマンドラインから以下を実行します。
```bash
streamlit run src/app.py
```

1. ブラウザが自動的に開き、アプリのUIが表示されます。ブラウザが自動的に開かない場合は、表示されるURLをブラウザに貼り付けてアクセスしてください。

### 仮想環境の終了

アプリの使用を終了したら、以下のコマンドで仮想環境を終了します。
```bash
deactivate
```


## ダッシュボードの基本操作

### ナビゲーション
左側のサイドバーにあるメニューから、閲覧したい分析ページを選択します。
各ページは特定の人事テーマ（離職、給与、パフォーマンスなど）に焦点を当てて構成しています。

### フィルタリング
各ページにはフィルタリングオプションがあり、特定の部門、職種、勤続年数などでデータを絞り込むことができます。フィルタは個別のページ内で設定し、そのページの分析にのみ適用されます。

### データ可視化
グラフやチャートはインタラクティブな設計にしています。
- グラフ上にマウスを置くと、詳細データが表示されます
- 多くのグラフでは、凡例をクリックすることで特定のデータを表示/非表示にできます
- 右上のツールバーを使用して、グラフをダウンロードしたり、全画面表示にしたりできます

### タブの切り替え
多くのページでは、分析内容をタブごとに整理しています。タブをクリックすると、異なる分析視点に切り替えることができます。


## 画面別機能詳細

### ホーム画面

ホーム画面は人事データの概要を表示し、主要な指標を一目で確認できます。

**主な機能**
- 主要KPIの表示（離職率、平均職務満足度、平均勤続年数、**高パフォーマンス離職者数**）
- 部門別従業員構成、役職レベル分布の可視化
- 部門別・年齢層別の離職率分析
- 職務満足度と勤続年数の関係性の可視化
- **リスクアラート**（特定の条件に合致する高リスク従業員群の割合と要因分析）

**使い方**
1. 左サイドバーから「🏠 ホーム・人材分析概要」を選択します。
2. 画面上部のカードで主要KPIを確認します。
3. スクロールダウンして、部門構成、役職分布、離職率分析、満足度と勤続年数のヒートマップ、リスクアラートを確認します。
4. サイドバーのフィルター（部署、年齢層、性別）を使用してデータを絞り込むことができます。

**実装された分析内容**
- **KPI概要カード**: 選択されたフィルターに基づき、離職率、平均職務満足度、平均勤続年数、高パフォーマンス離職者数を表示。全体平均との比較（デルタ）も表示されます。
- **部門別従業員構成**: 従業員の所属部門の割合を円グラフで表示。
- **役職レベル分布**: 従業員の役職レベル（JobLevel）の分布を棒グラフで表示。
- **離職率分析**: 部門別離職率（棒グラフ）と年齢層別離職率（線グラフ）を表示。
- **満足度と勤続年数の関係**: 職務満足度と勤続年数グループに基づいた従業員数のヒートマップを表示。
- **リスクアラート**: 低満足度、低ワークライフバランス、長期間昇進なしの従業員割合を特定し、関連リスク要因（低満足度、低WLB、昇進停滞、残業、低環境満足度など）の該当割合を棒グラフで表示。

### 離職分析

離職分析ページでは、従業員の離職に関する詳細な分析と予測モデルを表示するように構築しています。

**主な機能**
- 在籍状況の全体概要と部門別離職率の可視化
- 選択可能な要因（年齢、性別、職務満足度、残業など）と離職の関係性分析
- 数値特徴量間の相関分析
- 年齢・勤続年数・満足度要因と離職の関係パターン分析
- 勤続年数帯別の離職率パターン分析
- 複数の機械学習モデル（選択可能）による離職予測モデルの構築、評価（精度、混同行列、特徴量重要度）、リスクスコア分析

**使い方**
1. 左サイドバーから「🚪 離職分析」を選択します。
2. 上部の概要セクションで全体の在籍状況と部門別離職率を確認します。
3. タブを使用して異なる分析視点を切り替えます:
   - 「📊 離職要因分析」：分析したい要因を選択し、離職との関係や数値変数間の相関を確認。
   - 「🔍 離職パターン」：年齢、勤続年数、満足度などと離職の関係を散布図や箱ひげ図、線グラフで分析。
   - 「🤖 離職予測モデル」：モデルを選択し、構築・評価結果（精度、混同行列、重要度）やリスクスコア分布を確認。

**実装された分析内容**
- **離職概要**: 全体の在籍状況（円グラフ）、部門別離職率（棒グラフ）。
- **離職要因分析**
  - ユーザーが選択した要因（カテゴリ/数値）と離職率の関係を可視化（棒グラフ/ヒストグラム）。
  - 数値特徴量間の相関ヒートマップ。
- **離職パターン分析**
  - 年齢と勤続年数による離職パターン（散布図、月収をサイズで表現）。
  - 各種満足度要因（職務、環境、WLB、人間関係）と離職の関係（箱ひげ図）。
  - 勤続年数帯別の離職率（線グラフ）。
- **離職予測モデル**
  - ユーザーがモデル（ランダムフォレスト、勾配ブースティング、ロジスティック回帰、XGBoost、LightGBM）を選択可能。
  - チェックボックスでモデル学習を実行。
  - モデル精度、混同行列（Plotly）、特徴量重要度（棒グラフ）を表示。
  - 離職リスクスコアの分布（ヒストグラム）と、しきい値による高リスク従業員数の推定。
  - **(注意)** **READMEに記載のあったSHAP分析、離職コスト試算は現時点では実装されていません。**

### 人材獲得分析

採用プロセスに関する分析を提供します。**（注意：このページの分析は、元のデータセットには含まれていない情報を補うため、シミュレーションによって生成されたダミーデータに基づいています）**

**主な機能**
- **採用ファネル分析**
  - 応募から内定承諾までの各段階の通過数と転換率を分析。
  - 月別転換率のヒートマップ、全期間ファネルチャート。
  - 部門別のファネル効率、職種別の採用難易度（応募者数/採用日数）の分析。
  - 採用プロセスのボトルネック特定と改善提案。
- **採用コスト分析**
  - 総採用コスト、採用数、平均採用単価のKPI表示。
  - 月別のコストと採用数の推移。
  - 部門別・職種別の採用コスト効率分析。
  - **採用コスト最適化シミュレーション**（高コスト職種、チャネル配分、プロセス効率化）。
- **採用ソース分析**
  - 採用チャネル（リファラル、求人サイト等）別の効率性（応募効率、承諾率、コスト効率）をレーダーチャートと指標表で表示。
  - 職種別・地域別の効果的な採用ソースをヒートマップで分析し、推奨戦略を提示。
  - 月別の採用ソース効果のトレンド分析（線グラフ）。

**使い方**
1. 左サイドバーから「🎯 人材獲得分析」を選択します。
2. タブを使用して異なる分析視点を切り替えます
   - 「📊 採用ファネル分析」：採用プロセス全体の効率を分析。
   - 「💰 採用コスト分析」：採用にかかるコストを分析・シミュレーション。
   - 「🔍 採用ソース分析」：どの採用チャネルが効果的かを分析。
3. 各タブ内のフィルター（部門、職種など）やシミュレーション用スライダーを操作してより深い分析ができます。

### 人材育成・パフォーマンス分析

従業員の業績評価、能力開発、キャリアパスに関する分析を提供します。**（注意：このページの「ポテンシャル評価」「キャリアパス」に関する分析は、シミュレーションによって生成されたダミーデータに基づいています）**

**主な機能**
- **パフォーマンス概要**: 平均業績評価、高業績者の割合、平均研修回数のKPI表示。
- **業績評価分析**
  - 業績評価スコアの分布（円グラフ）。
  - 部門、職種、役職レベルなどのグループ別の平均業績評価（棒グラフ）。
  - 業績評価と他の要因（勤続年数、満足度、研修回数など）の関係（散布図/箱ひげ図）。
- **キャリア開発分析**
  - 役職レベル別の平均昇進間隔（棒グラフ）。
  - 研修回数と平均業績評価の関係（線グラフ）。
  - **キャリアパスシミュレーション**: 特定の職種から始まる典型的なキャリアパス（昇進経路、必要年数、スキル、昇進確率）を可視化。
- **タレントマッピング**
  - **9-boxタレントマップ**: 業績とポテンシャル（シミュレーション）に基づき従業員をプロット・分類。
  - 部門、職種などのグループ別のタレント分布（9-boxカテゴリの割合）をヒートマップで表示。
  - **タレントクラスタリング**: K-means法を用いて従業員を複数のクラスターに分類し、各クラスターの特性（業績、ポテンシャル、満足度など）をレーダーチャートで表示。

**使い方**
1. 左サイドバーから「📈 人材育成・パフォーマンス分析」を選択します。
2. タブを使用して異なる分析視点を切り替えます:
   - 「📈 業績評価分析」：業績評価の分布や関連要因を分析。
   - 「🔄 キャリア開発」：昇進、研修、キャリアパスを分析。
   - 「👥 タレントマッピング」：業績とポテンシャルで人材を可視化・分類。
3. 各タブ内のドロップダウンやマルチセレクト、スライダーを操作して分析対象や条件を変更します。

### 給与・報酬分析

従業員の給与データ分析と公平性の評価を提供します。

**主な機能**
- **給与分布分析**
  - 給与の基本統計（平均、中央値、範囲）のKPI表示。
  - 選択した給与指標（月収、昇給率など）の分布を、選択したグループ（役職レベル、部門など）別に表示（ヒストグラム）。
  - 選択したグループ（職種、等級など）別の月収分布（箱ひげ図）。
- **給与と業績/要因の関係**
  - 業績評価と月収の関係（散布図）。
  - 勤続年数と月収の関係（散布図、回帰線付き）。
  - 業績評価別の平均昇給率（棒グラフ）。
  - 各種満足度（職務、環境、WLB）と平均月収の関係（棒グラフ）。
- **給与の公平性分析**
  - 性別・役職レベル別の平均月収比較（グループ化棒グラフ）。
  - **統計的検定**: 選択した変数（性別、教育など）のグループ間で月収に有意差があるか検定（t検定/ANOVA）。
  - **多変量による給与格差分析**: 選択した2つの変数（例: 役職レベル vs 性別）の組み合わせにおける平均月収と、その差分をヒートマップで表示。

**使い方：**
1. 左サイドバーから「💰 給与・報酬分析」を選択します。
2. タブを使用して異なる分析視点を切り替えます:
   - 「📊 給与分布」：給与データの全体像やグループ別の分布を確認。
   - 「🔍 給与と業績の関係」：給与と他の要因（業績、勤続年数、満足度）との関連性を分析。
   - 「⚖️ 給与の公平性」：属性間の給与差を視覚的・統計的に分析。
3. 各タブ内のドロップダウンやチェックボックスを操作して、分析指標やグループ化変数を変更します。

### 従業員エンゲージメント

従業員の満足度、エンゲージメント、職場環境に関する分析と改善提案を提供します。

**主な機能**
- **エンゲージメント概要**: 各種満足度指標（職務、環境、WLB、人間関係）の平均スコアをKPI表示。
- **満足度分析**
  - 選択した満足度指標の分布（円グラフ）。
  - 満足度指標間の相関関係（ヒートマップ）。
  - グループ（部門、職種、年齢層など）別の平均満足度スコア（棒グラフ）。
- **エンゲージメント要因分析**
  - 選択した要因（勤続年数、月収、昇給率など）と満足度指標の相関分析（散布図マトリックス、相関係数棒グラフ、**統計的検定**）。
  - 残業の有無と各種満足度の比較（グループ化棒グラフ、**統計的検定**）。
- **アクションプラン**
  - 全体のエンゲージメント状況概要。
  - 低エンゲージメント従業員の特性（部門別割合、カテゴリ/数値特徴）を分析。
  - 分析結果に基づいたエンゲージメント向上施策の提案（ターゲット、課題、アクション、KPI）。

**使い方**
1. 左サイドバーから「🌟 従業員エンゲージメント」を選択します。
2. タブを使用して異なる分析視点を切り替えます:
   - 「📊 満足度分析」：各種満足度の分布やグループ間の違いを分析。
   - 「🔍 エンゲージメント要因」：満足度に影響を与える要因を相関や統計検定で分析。
   - 「📋 アクションプラン」：現状の課題を把握し、改善策のヒントを得る。
3. 各タブ内のドロップダウンやマルチセレクトを操作して、分析対象の指標や要因を選択します。

### 労働生産性/ワークスタイル分析

従業員の生産性パターン、ワークスタイルと業績の関係分析、および最適化シミュレーションを提供します。**（注意：このページの「最適化シミュレーション」に関する分析は、仮定に基づくシミュレーションデータに基づいています）**

**主な機能**
- **労働スタイルの概要**: 残業率、頻繁な出張率、平均WLBスコアのKPI表示。
- **ワークスタイル分析**
  - 残業状況: 部門別、勤続年数別、年齢層別の残業率（棒グラフ/線グラフ）。
  - 出張頻度: グループ（部門、職種など）別の出張頻度スコア、出張頻度と残業率の関係（棒グラフ）。
- **生産性要因分析**
  - ワークライフバランス、残業、各種満足度、通勤距離と、業績評価や満足度、残業率との関係を分析（棒グラフ/線グラフ）。
- **最適化シミュレーション**
  - **残業削減シミュレーション**: 目標削減率を設定し、WLBと業績への短期的・長期的影響を試算。
  - **リモートワーク導入シミュレーション**: 導入率と対象者を設定し、通勤時間、残業、WLB、業績への短期的・長期的影響を試算。
  - 分析結果に基づいた**推奨労働環境改善策**を提示。

**使い方**
1. 左サイドバーから「⏱️ 労働生産性/ワークスタイル分析」を選択します。
2. タブを使用して異なる分析視点を切り替えます:
   - 「🕒 ワークスタイル分析」：残業や出張などの働き方の実態を分析。
   - 「📊 生産性要因」：働き方や満足度が業績にどう影響するかを分析。
   - 「💡 最適化シミュレーション」：残業削減やリモート導入の効果を試算し、改善策のヒントを得る。
3. 各タブ内のドロップダウンやスライダーを操作して、分析対象やシミュレーション条件を変更します。

### 予測分析・シミュレーション

予測分析・シミュレーションページでは、機械学習モデルを活用して将来予測と「もし～だったら？」シナリオのシミュレーションを行います。

**主な機能**
- 離職予測モデル（ランダムフォレスト、勾配ブースティング、ロジスティック回帰、XGBoost、LightGBMの中から選択可能）
- 給与予測モデル
- インタラクティブな離職リスク予測
- 給与シミュレーター
- 人員計画シミュレーション

**使い方**
1. 左サイドバーから「🔮 予測分析・シミュレーション」を選択します
2. タブを使用して異なるシミュレーション機能を切り替えます：
   - 「🔮 離職予測」：離職予測モデルとインタラクティブシミュレーション
   - 「💰 給与予測」：給与予測モデルと給与シミュレーター
   - 「👥 人員計画シミュレーション」：将来の人員需要と採用計画のシミュレーション

3. 「離職予測」タブでは
   - ドロップダウンメニューから予測モデル（ランダムフォレスト、勾配ブースティング、ロジスティック回帰、XGBoost、LightGBM）を選択します
   - モデルの性能指標（精度、AUCなど）と特徴量重要度を確認できます
   - 下部の「インタラクティブな離職リスク予測」セクションでは
     - スライダーやドロップダウンを使用して従業員の特性を設定します
     - リアルタイムで離職確率が計算されます
     - 「もし～だったら？」シミュレーションで施策の効果を予測できます

4. 「給与予測」タブでは
   - ドロップダウンメニューから予測モデルを選択します
   - モデルの性能指標（R²、平均絶対誤差など）を確認できます
   - 下部の「給与シミュレーター」セクションでは：
     - 従業員の特性を入力して、予測される給与を確認できます
     - 同じ職種・役職の平均給与との比較が表示されます
     - 「昇給シミュレーション」で昇進や部門異動による給与変化を予測できます

5. 「人員計画シミュレーション」タブでは
   - ドロップダウンメニューから部門を選択します
   - 現在の部門構成（役職レベル別、職種別）が表示されます
   - 離職率予測に基づく将来の人員需要が計算されます
   - 下部のシミュレーションセクションでは
     - 計画期間、成長率、離職率の調整などのパラメータを設定します
     - 年次別・職種別の採用必要数が計算されます
     - 採用コストの試算も確認できます

**実装された機能詳細**
- **離職リスクスコアリング**
  - 個人ごとの離職リスクを0〜1のスコアで算出し、リスク層をセグメント化
  - リスクスコアの分布や、高リスク従業員の特性を視覚化
  - 部門別・職種別の高リスク従業員の割合とその特徴をサマリー表示

- **What-If分析シミュレーター**
  - 各種人事施策（昇給、昇進、研修、残業削減など）の効果を従業員ごとにシミュレーション
  - 施策の組み合わせによる相乗効果の予測
  - コスト対効果の試算（施策実施コストvs離職削減によるコスト削減額）

- **人員計画と予算シミュレーション**
  - 過去データからの成長率・離職率予測を基にした将来の人員需要予測
  - 部門別・職種別の採用必要数計算
  - 採用・研修・給与予算のシミュレーション
  - シナリオ比較機能（高成長vs安定成長、高離職率vs低離職率シナリオの比較）


## 分析モデル詳細

本システムでは以下の機械学習モデルを活用して高度な人事分析・予測を実現しています。各モデルはデータに基づいて定期的に再学習され、精度が維持されます。

### 離職予測モデル

**実装モデル一覧**

1. **ランダムフォレスト**（デフォルトモデル）
   - **概要**: 複数の決定木を組み合わせたアンサンブル学習モデル
   - **特徴**: バランスの取れた予測性能と解釈性を提供
   - **ハイパーパラメータ**: 
     - n_estimators: 100（決定木の数）
     - max_depth: 10（木の最大深さ）
     - random_state: 42（再現性のための乱数シード）
   - **典型的な精度**: 87-90%
   - **利点**: オーバーフィッティングに強く、特徴量の重要度が把握しやすい

2. **勾配ブースティング**
   - **概要**: 前の木の誤差を次の木が修正していく連続的なブースティングモデル
   - **特徴**: 高い予測精度を持つが、過学習に注意が必要
   - **ハイパーパラメータ**: 
     - n_estimators: 100（段階数）
     - max_depth: 5（木の最大深さ）
     - random_state: 42（再現性のための乱数シード）
   - **典型的な精度**: 88-92%
   - **利点**: 高い予測精度、特徴量の重要度が明確

3. **ロジスティック回帰**
   - **概要**: 確率論に基づく線形モデル
   - **特徴**: シンプルで解釈しやすい
   - **ハイパーパラメータ**: 
     - C: 1.0（正則化パラメータ）
     - class_weight: 'balanced'（クラス不均衡を調整）
     - random_state: 42（再現性のための乱数シード）
   - **典型的な精度**: 82-86%
   - **利点**: 高速で解釈しやすく、各特徴量の係数が直接的な影響度を示す

4. **XGBoost**
   - **概要**: 高度に最適化された勾配ブースティングモデル
   - **特徴**: 高い予測精度と優れた計算効率
   - **ハイパーパラメータ**: 
     - n_estimators: 100（ブースティング段階数）
     - max_depth: 6（木の最大深さ）
     - learning_rate: 0.1（学習率）
     - enable_categorical: True（カテゴリカル変数の自動処理）
   - **典型的な精度**: 90-94%
   - **利点**: 最高水準の予測性能、メモリ効率が良い

5. **LightGBM**
   - **概要**: Microsoft開発の軽量な勾配ブースティングモデル
   - **特徴**: 高速なトレーニングと予測
   - **ハイパーパラメータ**: 
     - n_estimators: 100（ブースティング段階数）
     - max_depth: 6（木の最大深さ）
     - learning_rate: 0.1（学習率）
   - **典型的な精度**: 89-93%
   - **利点**: 大規模データセットでも高速、メモリ使用量が少ない

**使用している主な特徴量**
- **人口統計学的特徴**: 年齢、性別、婚姻状況
- **職務特性**: 役職レベル、職種、部門、残業の有無
- **給与情報**: 月収、昇給率
- **勤続情報**: 勤続年数、現在の役職での年数、前回の昇進からの年数
- **満足度指標**: 職務満足度、環境満足度、ワークライフバランス
- **その他**: 通勤距離、研修回数、前職数

**モデル解釈手法**
- **特徴量重要度**: 各予測因子の相対的な重要性を示す
- **SHAP値分析**: 各特徴量が予測にどの程度、どの方向に貢献するかを詳細に解析
- **部分依存プロット**: 特定の特徴量の値の変化に応じて予測がどう変化するかを可視化

### 給与予測モデル

**実装モデル一覧**

1. **ランダムフォレスト回帰**（デフォルトモデル）
   - **概要**: 複数の決定木を組み合わせたアンサンブル学習モデル
   - **特徴**: バランスの取れた予測性能と解釈性を提供
   - **ハイパーパラメータ**: 
     - n_estimators: 100（決定木の数）
     - max_depth: 10（木の最大深さ）
     - random_state: 42（再現性のための乱数シード）
   - **典型的な精度**: R² 0.85-0.89
   - **利点**: オーバーフィッティングに強く、特徴量の重要度が把握しやすい

2. **線形回帰**
   - **概要**: 特徴量と目標変数の線形関係をモデル化
   - **特徴**: シンプルで解釈しやすい
   - **ハイパーパラメータ**: 
     - fit_intercept: True（切片を含める）
     - normalize: False（正規化なし）
   - **典型的な精度**: R² 0.75-0.80
   - **利点**: シンプルで計算が速く、解釈が容易

3. **勾配ブースティング回帰**
   - **概要**: 前の木の誤差を次の木が修正していく連続的なブースティングモデル
   - **特徴**: 高い予測精度を持つが、過学習に注意が必要
   - **ハイパーパラメータ**: 
     - n_estimators: 100（段階数）
     - max_depth: 5（木の最大深さ）
     - learning_rate: 0.1（学習率）
     - random_state: 42（再現性のための乱数シード）
   - **典型的な精度**: R² 0.86-0.90
   - **利点**: 高い予測精度、特徴量の重要度が明確

4. **XGBoost回帰**
   - **概要**: 高度に最適化された勾配ブースティングモデル
   - **特徴**: 高い予測精度と優れた計算効率
   - **ハイパーパラメータ**: 
     - n_estimators: 100（ブースティング段階数）
     - max_depth: 6（木の最大深さ）
     - learning_rate: 0.1（学習率）
     - objective: 'reg:squarederror'（回帰目標関数）
   - **典型的な精度**: R² 0.87-0.92
   - **利点**: 最高水準の予測性能、メモリ効率が良い

5. **LightGBM回帰**
   - **概要**: Microsoft開発の軽量な勾配ブースティングモデル
   - **特徴**: 高速なトレーニングと予測
   - **ハイパーパラメータ**: 
     - n_estimators: 100（ブースティング段階数）
     - max_depth: 6（木の最大深さ）
     - learning_rate: 0.1（学習率）
     - objective: 'regression'（回帰タスク）
   - **典型的な精度**: R² 0.86-0.91
   - **利点**: 大規模データセットでも高速、メモリ使用量が少ない

**使用している主な特徴量**
- **人口統計学的特徴**: 年齢、性別、学歴
- **職務特性**: 役職レベル、職種、部門、勤続年数
- **パフォーマンス指標**: 業績評価、達成目標数
- **エンゲージメント指標**: 満足度、ワークライフバランス評価
- **スキル関連**: トレーニング時間、取得資格数
- **その他**: 通勤距離、前職数、残業時間

**モデル解釈手法**
- **特徴量重要度**: 各予測因子の相対的な重要性を示す
- **部分依存プロット**: 特定の特徴量の値の変化に応じて予測がどう変化するかを可視化
- **回帰係数分析**: 線形モデルの係数による影響度の分析

**活用例**
- 新規採用者の適正給与の算出
- 昇給シミュレーション
- 給与の市場競争力分析
- 給与体系の公平性評価
- 部門間・職種間の給与格差の分析

### 人員需要予測モデル（開発中）

今後実装予定の人員需要予測モデルでは、以下の実装を計画しています（※現時点では未定）

- **実装予定モデル**: 時系列予測（ARIMA、Prophet）、機械学習モデル（ランダムフォレスト回帰）
- **主な特徴量**: 過去の人員データ、離職傾向、ビジネス成長率、季節性パターン
- **予測目標**: 部門別・職種別の将来の人員需要を予測し、採用計画と予算策定を支援
- **応用例**: 中長期人材戦略の策定、採用活動の最適化、人材育成計画の立案


## 高度な分析機能

### モデル比較

予測分析・シミュレーションページでは、複数の機械学習モデルを比較できます。

**使い方**
1. 「離職予測」または「給与予測」タブで、異なるモデルを選択します
2. 各モデルの性能指標を比較します
3. 特徴量重要度の違いを分析して、モデルごとの予測ロジックの違いを理解します

### カスタムシミュレーション

「もし～だったら？」シミュレーション機能を使用して、人事施策の効果を予測できます。

**使い方**
1. 離職予測や給与予測のインタラクティブセクションで基本パラメータを設定します
2. 「シミュレーションしたい変更を選択してください」から施策を選択します
3. 選択した施策による効果（離職確率の変化や給与の変化）が表示されます
4. 複数の施策を組み合わせて、最適な施策の組み合わせを探索できます


## データの更新方法

現在のシステムは[IBMのHRアナリティクスデータセット](https://www.kaggle.com/datasets/pavansubhasht/ibm-hr-analytics-attrition-dataset)を使用していますが、カスタマイズして独自の人事データ分析を行うことも可能です。

### データ形式要件

- CSVファイル形式
- IBMデータセットと同じ列名を使用するか、データローダーを調整する必要があります
- 最低限必要な列：従業員ID、離職状況（Attrition）、部門、職種、年齢、給与、勤続年数

### データ更新手順

1. 新しいCSVファイルを `data/raw/` ディレクトリに配置します
2. `src/data/loader.py` ファイルを編集して、新しいファイルパスを指定します
3. 必要に応じて、データの前処理ロジックを `src/data/cleaner.py` で調整します
4. アプリケーションを再起動して、新しいデータを読み込みます

### 定期データ更新の自動化

定期的なデータ更新を自動化するには：
1. データ更新スクリプトを作成します
2. crontabやWindowsタスクスケジューラを使用して定期実行を設定します
3. 更新スクリプトが実行された後、アプリケーションを再起動するロジックを追加します


## よくある質問

### Q: 分析結果やグラフをエクスポートできますか？
A: 多くのグラフ（Plotlyで作成されたもの）には、右上にカメラアイコンがあり、画像（PNG形式）としてエクスポートできます。現時点では、表形式のデータを直接CSVとしてダウンロードする機能は実装されていません。

### Q: 予測モデルの精度はどのくらいですか？
A: モデルの精度は、「予測分析・シミュレーション」ページで選択したアルゴリズムや、データの内容によって変動します。各モデルの性能指標（離職予測ではAccuracyとROC-AUC、給与予測ではR²と平均絶対誤差）は、モデルを学習させた際にページ上に表示されます。一般的に、ランダムフォレスト、XGBoost、LightGBMなどのアンサンブルモデルが比較的高い精度を示す傾向にありますが、データセットや目的に応じて最適なモデルは異なります。

### Q: 予測モデルはどのように学習・更新されますか？
A: 「予測分析・シミュレーション」ページの各タブ（離職予測、給与予測）で、モデルの種類を選択すると、その場でデータの一部（通常は70%）を使ってモデルが学習され、残りのデータ（30%）で性能が評価されます。モデルの自動更新機能は現在実装されていません。新しいデータで分析を行いたい場合は、データファイルを更新し、アプリケーションを再起動して、再度ページ上でモデル学習を実行する必要があります。

### Q: 新しい従業員データを追加するにはどうすればよいですか？
A: 現在のバージョンでは、`data/raw/WA_Fn-UseC_-HR-Employee-Attrition.csv` ファイルを直接編集（新しいレコードを追加・既存レコードを更新）し、アプリケーションを再起動することで、更新されたデータが反映されます。

### Q: 他のデータソース（データベースなど）からデータをインポートできますか？
A: 原則として可能です。ただし、現在の実装は特定のCSVファイルを読み込むことを前提としています。データベースやAPIなど他のデータソースからデータをインポートするには、`src/data/loader.py`内の`load_hr_data`関数をカスタマイズする必要があります。また、カラム名やデータ構造が異なる場合は、各分析ページ (`src/pages/*.py`) のコード修正も必要になる可能性があります。

### Q: モデルの予測結果をどのように解釈すればよいですか？
A: 予測結果（例: 離職確率、予測給与）と合わせて、モデルが示す「特徴量重要度」のグラフを確認することが有効です。これにより、どの要因（例: 残業、職務満足度、役職レベル、勤続年数）が予測に強く影響しているかを把握できます。例えば、離職予測でリスクが高いと判定された従業員について、重要度の高い要因を確認することで、具体的な課題や対策のヒントを得ることができます。**(注意: SHAP値分析による詳細な要因寄与度の可視化機能は、現時点ではUIに実装されていません)**

### Q: カスタムモデルを追加できますか？
A: はい、コードを直接編集することで可能です。例えば、離職予測モデルを追加したい場合は、`src/models/attrition.py`内の`MODELS`辞書に新しいモデルクラス（例: `MyCustomClassifier()`）とその設定を追加します。給与予測モデルの場合は、`src/pages/simulation.py`内の`REGRESSION_MODELS`辞書を同様に編集します。追加するモデルによっては、関連する前処理や評価コードの調整が必要になる場合があります。

### Q: 離職予測モデルでリスクが高いと判定された従業員にはどのように対応すべきですか？
A: 高リスク従業員への対応は慎重に行う必要があります：
1. 予測はあくまで統計的な傾向を示すものであり、個々の従業員が必ず離職するわけではないことを理解してください。
2. 特徴量重要度などを参考に、その従業員に影響している可能性のある要因（満足度、キャリア、WLBなど）を推測します。
3. 直接的に「あなたは離職リスクが高い」と伝えることは避け、通常の面談などを通じて、本人のキャリア志向、懸念事項、満足度などについて対話を持つ機会を設けます。
4. 個別の対応と並行して、組織全体で共通して見られる離職リスク要因（例: 特定部門での高い残業率、低い満足度）に対して、組織的な改善策を検討・実施することが重要です。


## トラブルシューティング

### アプリケーションが起動しない

**考えられる原因と解決策**
1. Pythonバージョンの不一致：Python 3.8以上が推奨されます。バージョンを確認してください (`python --version` または `python3 --version`)。
2. 依存パッケージの不足・不整合：`pip install -r requirements.txt` を実行し、必要なライブラリが正しくインストールされているか確認してください。仮想環境の使用を強く推奨します。
3. ポートの競合：既定のポート（通常は8501）が他のプロセスで使用中の可能性があります。`streamlit run src/app.py --server.port 8502` のように、コマンドで別のポート番号を指定して起動してみてください。

### グラフが表示されない、またはエラーが表示される

**考えられる原因と解決策**
1. データの問題：`data/raw/WA_Fn-UseC_-HR-Employee-Attrition.csv` ファイルが存在し、内容が正しいか確認してください。データが破損している、または空の場合、エラーが発生します。
2. ブラウザの問題：お使いのウェブブラウザ（Chrome, Firefox, Edgeなど）が最新バージョンであることを確認してください。ブラウザのキャッシュをクリアするか、シークレット/プライベートウィンドウで試すことも有効です。
3. ライブラリのバージョン競合：`requirements.txt`に記載されたバージョンと異なるライブラリがインストールされている場合、予期せぬエラーが発生することがあります。仮想環境で依存関係を再インストールしてみてください。

### 予測モデルの学習中や予測時にエラーが発生する

**考えられる原因と解決策**
1. データの前処理エラー：データ内に予期せぬ値（数値列に文字列が含まれるなど）や欠損値があり、モデル学習前の処理（StandardScaler, OneHotEncoderなど）でエラーが発生している可能性があります。データの内容を確認してください。`notebooks/exploration/01_data_exploration.ipynb` を実行してデータ品質を確認することも有効です。
2. メモリ不足：特に多数のモデルを同時に試したり、データ量が非常に多い場合、マシンのメモリが不足することがあります。不要なプロセスを終了させる、またはよりスペックの高い環境で実行することを検討してください。
3. ライブラリ固有のエラー：特定のモデル（XGBoost, LightGBMなど）がOS環境や他のライブラリとの互換性の問題でエラーを起こす場合があります。エラーメッセージを確認し、関連するライブラリのバージョンを確認・調整してください。

### アプリケーションの動作が遅い

**考えられる原因と解決策**
1. データサイズ：データ量が多い場合、特にインタラクティブなグラフや複雑な計算（モデル学習など）に時間がかかることがあります。分析対象を絞るフィルターを活用してください。
2. モデルの複雑さ：複雑なモデル（例: 多数の決定木を持つRandomForestやGradientBoosting）は、学習や予測に時間がかかります。よりシンプルなモデル（例: LogisticRegression, LinearRegression）を試すことも検討してください。
3. ハードウェアの制限：お使いのコンピュータのCPU性能やメモリ容量が影響している可能性があります。

---

ご質問やフィードバックがある場合は、開発者（yf591）までお問い合わせください。